{
    "Version": "2012-10-17",
    "Statement": [
        {   "Sid":    "ExplicitDenyPermissions",
            "Effect": "Deny",
            "Action": [
                "cloudtrail:DeleteTrail*",
                "cloudtrail:StopLogging*",
                "cloudtrail:UpdateTrail*",
                "ec2:CreateVpc*",
                "guardduty:*",
                "iam:*User*",
                "iam:DeleteRolePermissionsBoundary"
                ],
            "Resource": "*"
        },
        {
            "Sid": "DenySSMSendCommand",
            "Effect": "Deny",
            "Action": "ssm:SendCommand",
            "Resource": "arn:aws:ec2::*:instance/*"
        },
        {   "Sid": "ServicePermissions",
            "Effect": "Allow",
            "Action": [
                "acm-pca:*",
                "acm:*",
                "amplify:Get*",
                "amplify:List*",
                "apigateway:*",
                "appflow:*",
                "app-integrations:*",
                "application-autoscaling:*",
                "applicationinsights:*",
                "appmesh:*",
                "appsync:*",
                "athena:*",
                "autoscaling-plans:Describe*",
                "autoscaling-plans:GetScalingPlanResourceForecastData*",
                "autoscaling:*",
                "backup:Describe*",
                "backup:Get*",
                "backup:List*",
                "backup:StartRestoreJob",
                "batch:Describe*",
                "batch:List*",
                "cloudformation:*",
                "cloudfront:*",
                "cloudsearch:Describe*",
                "cloudsearch:List*",
                "cloudtrail:Describe*",
                "cloudtrail:Get*",
                "cloudtrail:List*",
                "cloudtrail:LookupEvents",
                "cloudwatch:*",
                "codeartifact:*",
                "codebuild:*",
                "codecommit:*",
                "codedeploy:*",
                "codepipeline:*",
                "codestar-connections:*",
                "config:Delete*",
                "config:Deliver*",
                "config:Describe*",
                "config:Get*",
                "config:List*",
                "config:Tag*",
                "config:Untag*",
                "connect:*",
                "cur:*",
                "datasync:*",
                "directconnect:Describe*",
                "dms:*",
                "ds:*",
                "dynamodb:*",
                "ec2:*",
                "ec2messages:*",
                "ecr:*",
                "ecs:*",
                "eks:*",
                "elasticache:*",
                "elasticbeanstalk:Check*",
                "elasticbeanstalk:Describe*",
                "elasticbeanstalk:List*",
                "elasticbeanstalk:Request*",
                "elasticbeanstalk:Retrieve*",
                "elasticbeanstalk:Validate*",
                "elasticfilesystem:*",
                "elasticloadbalancing:*",
                "elasticmapreduce:*",
                "elastictranscoder:List*",
                "elastictranscoder:Read*",
                "es:*",
                "events:*",
                "execute-api:*",
                "firehose:*",
                "fsx:*",
                "glacier:*",
                "globalaccelerator:Describe*",
                "globalaccelerator:List*",
                "glue:*",
                "guardduty:Get*",
                "guardduty:List*",
                "health:Describe*",
                "iam:CreateOpenIDConnectProvider",
                "iam:DeleteOpenIDConnectProvider",
                "iam:Get*",
                "iam:List*",
                "iam:Tag*",
                "iam:Untag*",
                "iam:UpdateOpenIDConnectProviderThumbprint",
                "importexport:Get*",
                "importexport:List*",
                "inspector:*",
                "inspector:Describe*",
                "inspector2:Get*",
                "inspector:List*",
                "inspector:Preview*",
                "kafka-cluster:*",
                "kafkaconnect:*",
                "kafka:*",
                "kinesis:*",
                "kinesisanalytics:*",
                "kinesisvideo:*",
                "kms:*",
                "lakeformation:*",
                "lambda:*",
                "lex:*",
                "lightsail:*",
                "logs:*",
                "mq:Describe*",
                "mq:List*",
                "organizations:Describe*",
                "organizations:List*",
                "profile:*",
                "quicksight:*",
                "rds-db:*",
                "rds:*",
                "redshift-data:*",
                "redshift:*",
                "resource-groups:*",
                "route53:ChangeResourceRecordSets",
                "route53:ChangeTagsForResource",
                "route53:Get*",
                "route53:List*",
                "route53:Test*",
                "route53domains:Check*",
                "route53domains:Get*",
                "route53domains:List*",
                "route53domains:View*",
                "s3:*",
                "sagemaker:*",
                "sdb:Get*",
                "sdb:List*",
                "sdb:Select*",
                "secretsmanager:*",
                "securityhub:Get*",
                "securityhub:List*",
                "serverlessrepo:Get*",
                "serverlessrepo:List*",
                "serverlessrepo:SearchApplications",
                "servicediscovery:Get*",
                "servicediscovery:List*",
                "servicequotas:Get*",
                "ses:Get*",
                "ses:List*",
                "shield:*",
                "sns:*",
                "sqs:*",
                "ssm:*",
                "ssmmessages:*",
                "states:*",
                "storagegateway:*",
                "sts:Get*",
                "sts:DecodeAuthorizationMessage",
                "swf:Count*",
                "swf:Describe*",
                "swf:Get*",
                "swf:List*",
                "synthetics:*",
                "tag:Get*",
                "transcribe:*",
                "transfer:Describe*",
                "transfer:List*",
                "transfer:TestIdentityProvider",
                "trustedadvisor:Describe*",
                "voiceid:*",
                "waf-regional:Get*",
                "waf-regional:List*",
                "wafv2:*",
                "workspaces:Describe*",
                "xray:*"
            ],
            "Resource": "*"
        },
        {
            "Sid":"IAMRoleAndPolicyPermissions",
            "Effect": "Allow",
            "Action": [
                "iam:*PermissionsBoundary",
                "iam:*Role",
                "iam:*RolePolicy",
                "iam:UpdateRoleDescription"
            ],
            "Resource": "arn:aws:iam::${ACCOUNT_ID}:role/local*"
        },
        {
            "Sid": "InstanceProfilePermissions",
            "Effect": "Allow",
            "Action": "iam:*InstanceProfile",
            "Resource":  "arn:aws:iam::${ACCOUNT_ID}:instance-profile/local*"
        },
        {
            "Sid": "RolePermissions",
            "Effect": "Allow",
            "Action": [
                "iam:PassRole",
                "sts:AssumeRole"
            ],
            "Resource": [
                "arn:aws:iam::*:role/aws-service-role/*",
                "arn:aws:iam::*:role/local*"
            ]
        },
        {
            "Sid": "ServiceLinkedRoleActions",
            "Effect": "Allow",
            "Action": [
                "iam:CreateServiceLinkedRole",
                "iam:DeleteServiceLinkedRole",
                "iam:GetServiceLinkedRoleDeletionStatus"
            ],
            "Resource": "*"
        },
        {   "Sid": "AllowIAMPolicyActions",
            "Effect": "Allow",
            "Action": [
                "iam:CreatePolicy",
                "iam:CreatePolicyVersion",
                "iam:DeletePolicy",
                "iam:DeletePolicyVersion",
                "iam:SetDefaultPolicyVersion"
            ],
            "Resource": "arn:aws:iam::${ACCOUNT_ID}:policy/local*"
        },
        {
            "Sid": "DenyAttachRolePolicy",
            "Effect": "Deny",
            "Action": "iam:AttachRolePolicy",
            "Resource": "arn:aws:iam::${ACCOUNT_ID}:role/local*",
            "Condition": {
                "ArnNotLike":{
                "iam:PolicyARN": [
                    "arn:aws:iam::${ACCOUNT_ID}:policy/local*"
                ]
                }
            }
        },
        {
            "Sid": "DenyAccessIfRequiredPermBoundaryIsNotApplied",
            "Effect": "Deny",
            "Action": [
                "iam:CreateRole",
                "iam:PutRolePermissionBoundary"
            ],
            "Resource": "arn:aws:iam::${ACCOUNT_ID}:role/local*",
            "Condition": {
                "StringNotEquals":{
                "iam:PermissionsBoundary": [
                    "arn:aws:iam::${ACCOUNT_ID}:policy/Service-Boundary-Policy"
                ]
                }
            }
        },
        {
            "Sid": "DenyPermboundaryIamPolicyAlteration",
            "Effect": "Deny",
                "Action": [
                    "iam:CreatePolicy*",
                    "iam:DeletePolicy*",
                    "iam:SetDefaultPolicyVersion"
                ],
                "Resource": "arn:aws:iam::${ACCOUNT_ID}:policy/Service-Boundary-Policy"
            }
    ]
}
